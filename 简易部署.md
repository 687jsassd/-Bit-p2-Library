# 在线图书管理系统简易部署文档

## 系统要求

- Linux 服务器（Ubuntu 20.04 推荐）
- Python 3.8+
- MySQL 8.0+
- Git

## 安装步骤

### 1. 安装系统依赖

```
sudo apt update
sudo apt install python3-pip python3-venv git nginx mysql-server -y
```

### 2. 配置 MySQL

```
sudo mysql -u root

# 在 MySQL shell 中执行
CREATE DATABASE Library_full;
CREATE USER 'library_user'@'localhost' IDENTIFIED BY 'your_password';
GRANT ALL PRIVILEGES ON Library_full.* TO 'library_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

### 3. 获取应用代码

```
cd /opt
sudo git clone https://github.com/your-username/library-system.git
sudo chown -R $USER:$USER library-system
cd library-system
```

### 4. 设置 Python 环境

```
python3 -m venv venv
source venv/bin/activate
pip install --upgrade pip
pip install -r requirements.txt
```

### 5. 创建配置文件

创建 `.env`文件：

```
nano .env
```

内容：

```
SECRET_KEY=your_secret_key
SQLALCHEMY_DATABASE_URI=mysql+pymysql://library_user:your_password@localhost/Library_full
JWT_SECRET_KEY=your_jwt_secret
```

### 6. 初始化数据库

```
flask db init
flask db migrate -m "Initial tables"
flask db upgrade
```

## 运行应用

### 开发模式

```
flask run --host=0.0.0.0 --port=5000
```

### 生产模式（使用 Gunicorn）

```
# 安装 Gunicorn
pip install gunicorn

# 启动服务
gunicorn -w 4 -b 0.0.0.0:5000 app:app
```

## 访问应用

在浏览器中访问：`http://服务器IP:5000`

## 创建管理员用户

```
flask shell
>>> from models import User
>>> from database import db
>>> admin = User(username='admin', email='admin@example.com', phone='12345678901', 
                password='pbkdf2:sha256:260000$salt$hash', 
                name='Admin', privilege=1)
>>> db.session.add(admin)
>>> db.session.commit()
>>> exit()
```